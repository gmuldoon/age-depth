\subsection{Metropolis Algorithm}\label{metrop}
At each iteration, the Metropolis/Gibbs sampling algorithm \citep{metropolis1953,hastings1970} proposes values for parameters of interest (those with priors in Equation~\ref{eqn:bigproblem}). The algorithm accepts or rejects proposed sets of parameter values by comparison between the proposed and previously-accepted likelihood (or ``cost") values. A low cost value represents good agreement between model and observations, reflecting a small model-data misfit. According to the Metropolis/Gibbs algorithm, if the cost associated with proposed parameters is lower than that of the last accepted iteration, the proposed parameter values are accepted. Alternatively, higher cost values may be accepted with a probability determined by the likelihood. Each likelihood function is considered separately and both must represent an adequate solution on a given iteration for the proposed parameters to be accepted.


There are two likelihood functions, describing the model-data misfit between reflector depth and age, respectively:


\begin{equation}\label{eqn:loglikeage}
p(A_{IC} | D_{IC},\vec{f},S) \propto exp[\frac{-S\sum_{j = 61}[A_{IC,j} - A_{m,j}(\vec{f},D_{IC})]^2}{2\sigma_A^2} + r^6]
\end{equation}

\begin{equation}\label{eqn:loglikedepth}
p(TWTT_r | D_r,d_{firn},v_{ice} ) \propto exp[\frac{-\sum_{i=4}[TWTT_{r,i} - TWTT_{m,i}(D_r)]^2}{2\sigma_{TWTT}^2}]
\end{equation}


In the depth likelihood function, $TWTT_m(D_r)$ is based on the relationship between depth and TWTT as in Equation~\ref{deptheqn} and $TWTT_r$ is observed by ice-penetrating radar for each reflector, $i$. To estimate $\sigma_{TWTT}$, we assume a perfect model and compute with standard deviation of the numerator given typical errors we expect affect our data. This method allows for correlation between depth errors, as expected. More details are discussed in the Supplement.


In the age likelihood function, the modeled age, $A_m$, is a function of ice flow model parameters, $\vec{f}$. A regularization term, $r^6$, is used to penalize large variability in the sampled accumulation rate function input to the ice flow model and $A_m$ comes from solutions to the forward ice flow model. We train our model on $J=61$ volcanic events from \citet{hammer1997}. Importantly, these volcanic ages are overly confident in that they do not include uncertainty information. To accomodate additional unknown uncertainty in this data, we include an unknown precision parameter, $S$, and use it to infer uncertainty in the volcanic record from scatter between our model and the observed data. $S$ is a ``nuisance" parameter that accounts for uncertainty in $\sigma_A$ by using $E_m$ as a measure of scatter between modeled age $A_m$ and $\Pi(S) \propto Ga(\alpha,\beta)$ The posterior probability distribution of $S$ is therefore:

\begin{equation}\label{eqn:S}
PPD(S) = Ga(\frac{k_e}{2}+\alpha, E_m+\beta)
\end{equation}
where 
\begin{equation}
 E_m= \frac{\sum_{j}[A_{IC,j} - A_{m,j}(\vec{f},D_{IC})]^2}{2\sigma_A^2} 
\end{equation}

Parameters $\alpha$ and $\beta$ are assumed to be 1 as in the case for a noninformative gamma prior. The scatter between the model and data is represented by the cost, $E_m$, which determines the uncertainty. The number of degrees of freedom, $k_e$, is assumed to be less than $J$ due to covariation in the age and depth of ice. Because we do not know the value of $k_e$ a priori, we assume $k_e = \frac{J}{2}$ (see Supplement). Unlike other parameters in our problem in which Metropolis-Hastings sampling is used, values of $S$ are proposed using Gibbs sampling \citep{gelfand1992}, effectively estimating reflector age uncertainty given the choice of parameter solution for each iteration.


%The Metropolis algorithm randomly samples each of the ice flow parameters and computes an age-depth profile. A Bayesian method is used to determine suitability of proposed ice flow parameters in a Bayesian way:
%\begin{equation}\label{posterior}
% p(\vec{f},\sigma_V | A_V, D_V) \propto p(A_V,D_V | \vec{f},\sigma_V) p(\vec{f}) p(\sigma_V),
%\end{equation}
%A posterior probability, $p(A | \vec{f})$, is computed for each set of parameters from likelihood and prior probabilities, $P(\vec{f})$. As described below, we require only the proportional relation because relative posterior values are considered in this Markov Chain process.

%The simulated age-depth profile is compared to the observed volcanic chronology using the ``log-likelihood" function, $p(A_V,D_V | \vec{f},\sigma_V)$, to quantify how closely a sampled set of parameters represents the observed ice profile:
%
%\begin{equation}\label{cost}
%ln(likelihood) = \frac{1}{N}\sum\frac{(A_{sim}(\vec{f})_i~ - ~A_{V,i})^2}{(2\sigma_{V})^2},
%\end{equation}
%where $\vec{Age}_{sim}$ comes from evaluating the ice flow model for parameter values sampled from $\vec{f}$. $A_{V}$ and $\sigma_{V}$ describe the observed volcanic chronology at the Byrd ice core. The prior on $\sigma_{V}$ is 
%\begin{equation}
%p(\sigma_V) \sim Ga(\alpha, \beta)
%\end{equation}

%which assumes error in the chronology is $\sim$3\% (T.J. Fudge, pers. comm.). Uncertainty in the volcanic chronology, $\sigma_{V}$, loosens the constraint on how closely $A_{sim}$ must match $A_{V}$ to be acceptable. We assume $N$ degrees of freedom, where $N$ is the number of volcanic observations. This is because observed global volcanic events are assumed independent.
%


